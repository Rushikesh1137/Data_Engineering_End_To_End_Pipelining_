
-- https://learn.microsoft.com/en-us/azure/synapse-analytics/sql/develop-tables-cetas

create schema gold

CREATE view gold.final
as 
select
    * 
    FROM OPENROWSET(
    BULK 'https://datalakeawstoragefor.dfs.core.windows.net/olisdata/silver/*.parquet',
    FORMAT = 'PARQUET'
) AS [result]
where order_status = 'delivered'




SELECT
top 100 *
FROM OPENROWSET(
    BULK 'https://datalakeawstoragefor.dfs.core.windows.net/olisdata/silver/*.parquet',
    FORMAT = 'PARQUET'
) AS [result];


CREATE MASTER KEY ENCRYPTION BY PASSWORD = 'Rushikesh@2001';

CREATE DATABASE SCOPED CREDENTIAL RushikeshAdmin
WITH IDENTITY = 'Managed Identity';--created credentials

-- select * from sys.database_credentials
--DROP EXTERNAL FILE FORMAT ParquetFileFormat;


-- Step 1: Create file format
CREATE EXTERNAL FILE FORMAT ParquetFileFormat
WITH (FORMAT_TYPE = PARQUET);


-- Step 2: Create data source
CREATE EXTERNAL DATA SOURCE MyDataLake
WITH (
    LOCATION = 'https://datalakeawstoragefor.dfs.core.windows.net/olisdata/gold',
    CREDENTIAL = RushikeshAdmin
);

-- Step 3: Use in CETAS
CREATE EXTERNAL TABLE gold.delivered_orders
WITH (
    LOCATION = 'final_order/',--location name
    DATA_SOURCE = MyDataLake,
    FILE_FORMAT = ParquetFileFormat
)
AS
SELECT * FROM gold.final




